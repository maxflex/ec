<?php

namespace App\Console\Commands\Once;

use App\Models\Phone;
use App\Models\TelegramMessage;
use Illuminate\Console\Command;

class ReportNotificationCommand extends Command
{
    protected $signature = 'once:report-notification';

    protected $description = 'Отправляет сообщение, что была ошибка в отчетах';

    public function handle(): void
    {
        $telegramIds = [5086699719, 2110893251, 392377661, 2123045217, 807406249, 5297700783, 5108786509, 416149178, 325708359, 1299085819, 188090279, 915599682, 1164984682, 1713940573, 938173347, 250884440, 243306300, 189766423, 6308778764, 308912271, 356823923, 1827005567, 360833712, 1880733965, 906207723, 1051597321, 622363447, 5138610378, 1186929371, 577120315, 1124158033, 1251412980, 377401676, 1317197295, 1230393624, 222883364, 400114509, 5793605572, 1078500772, 445490036, 452182461, 860001927, 5212030220, 397476476, 5024263105, 1625078999, 1124504799, 466476630, 812546507, 2095771490, 450787716, 561465876, 518974128, 401193778, 7199898721, 1055738720, 5272937310, 1044616316, 1313491730, 5514392580, 962184642, 523555285, 296128318, 5552059246, 460135200, 1137103470, 371262730, 2019123124, 179169016, 1121554959, 905968766, 1821373051, 1682063741, 1879946743, 5298074191, 734988023, 1446810296, 1365819607, 6245258201, 1770842989, 519509724, 871953769, 687488411, 549745245, 901057266, 1993858004, 1680558935, 1103232118, 5203743856, 189284988, 7004265348, 1777608742, 7485595880, 570521482, 1002093579, 5205093948, 1381931374, 323666114, 6336865895, 1883978986, 1281539217, 5203147811, 5206751625, 5132786448, 5142559876, 1072662298, 2056282136, 1214716492, 1473004129, 1996579216, 5438781478, 377424836, 5144855017, 5150211621, 6218540091, 738060378, 5320219910, 5284213654, 1652308781, 1201808176, 269271423, 660870606, 1247649247, 809143094, 1295725058, 1726065095, 986799526, 5290449969, 1370803585, 6956295606, 126173402, 387512889, 2125894350, 52048675, 6258208365, 1430494926, 1450937465, 5445799343, 5237546971, 1019728365];
        $bar = $this->output->createProgressBar(count($telegramIds));
        foreach ($telegramIds as $telegramId) {
            $phone = Phone::where('telegram_id', $telegramId)->first();
            if ($phone) {
                $entity = $phone->entity;
                $text = <<<HTML
$entity->first_name $entity->middle_name, здравствуйте!

Из-за технической неполадки ранее отправленные отчёты содержали не всю информацию. Полный текст отчёта доступен в вашем личном кабинете. Вы можете ознакомиться с ним по ссылке:
https://lk.ege-centr.ru/reports
HTML;
                TelegramMessage::send($phone, $text);
            }
            $bar->advance();
        }
        $bar->finish();
    }
}
